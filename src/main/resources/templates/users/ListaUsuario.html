<!DOCTYPE html>
<html lang="es"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{fragments/layout :: head('Usuarios')}"></head>

<body>
<div th:replace="~{fragments/header :: topbar}"></div>

<div class="container">

    <div class="hero">
        <h1>Usuarios</h1>
        <p>Listado general. Solo <b>ADMIN</b> puede crear/editar/eliminar.</p>

        <div class="alert ok" th:if="${msg}" th:text="${msg}"></div>
        <div class="alert err" th:if="${error}" th:text="${error}"></div>
    </div>

    <div class="row row-between row-top gap-16 mt-14">
        <div class="muted" style="font-size:13px;">
            Doble click en una fila para ver detalle.
        </div>

        <div sec:authorize="hasRole('ADMIN')">
            <a class="btn btn-primary" th:href="@{/users/new}">+ Nuevo usuario</a>
        </div>
    </div>

    <div class="card mt-12 p-0">
        <table class="tbl">
            <thead>
            <tr>
                <th>Usuario</th>
                <th style="width: 180px;">Rol</th>
                <th style="width: 120px;">Estado</th>
                <th sec:authorize="hasRole('ADMIN')" style="width: 160px;">Acciones</th>
            </tr>
            </thead>

            <tbody>
            <tr th:each="u : ${users}"
                th:attr="data-id=${u.id}"
                ondblclick="goDetail(this)">

                <td><b th:text="${u.username}"></b></td>

                <td><span class="chip" th:text="${u.rol}"></span></td>

                <td>
                    <span class="chip"
                          th:text="${u.enabled} ? 'Activo' : 'Inactivo'"></span>
                </td>

                <td sec:authorize="hasRole('ADMIN')">
                    <div class="actions">
                        <a class="iconbtn" th:href="@{/users/{id}(id=${u.id})}" title="Editar">✏</a>
                        <a class="iconbtn danger" th:href="@{/users/{id}/confirm-delete(id=${u.id})}" title="Eliminar">✖</a>
                    </div>
                </td>
            </tr>

            <tr th:if="${users == null or #lists.isEmpty(users)}">
                <td colspan="4" class="muted">No hay usuarios cargados.</td>
            </tr>
            </tbody>
        </table>
    </div>

</div>

<script>
    function goDetail(row) {
        const id = row.getAttribute("data-id");
        window.location.href = "/users/" + id;
    }
</script>

</body>
</html>